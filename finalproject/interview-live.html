<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live Interview Practice | Job Seekers</title>
  <meta name="description" content="Experience realistic live AI voice interviews directly in your browser using text-to-speech and speech recognition technology." />
  <meta name="author" content="Jones Awuah" />
  <link rel="icon" href="images/favicon.png" type="image/png" />

  <meta property="og:title" content="Live Interview Practice | Job Seekers" />
  <meta property="og:description" content="Simulate real interviews with live AI voice and speech recognition to enhance your communication confidence." />
  <meta property="og:image" content="https://jonesawuah.github.io/wdd231/finalproject/images/live-interview.webp" />
  <meta property="og:url" content="https://jonesawuah.github.io/wdd231/finalproject/interview-live.html" />

  <link rel="stylesheet" href="styles/index.css" />
  <link rel="stylesheet" href="styles/resources.css" />
  
  <style>
    :root{
      --deep:#0c4b78;
      --accent:#00a5cf;
      --bg:#f5f8fa;
      --card:#fff;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, "Segoe UI", Arial, sans-serif;
      background:var(--bg);
      color:#123;
      -webkit-font-smoothing:antialiased;
    }
    header {
      background: #0c4b78;
      color: #fff;
      text-align: center;
      padding: 2.5rem 1rem;
    }

    header h1 {
      margin-bottom: 0.5rem;
    }

    header p {
      opacity: 0.9;
    }
    
    .btn {
      display: inline-block;
      margin-top: 1rem;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      text-decoration: none;
      color: #fff;
    }

    .btn:hover {
      transform: scale(1.05);
    }

    .submit-btn {
      background-color: #007bff;
    }

    .next-btn {
      background-color: #28a745;
      margin-left: 10px;
    }

    .back-btn {
      background-color: #6c757d;
    }

    
    main{max-width:1000px;margin:22px auto;padding:18px}
    .grid{display:grid;grid-template-columns: 1fr 420px; gap:18px}
    .card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 6px 18px rgba(15,25,40,0.06)}
   
    p.lead{margin:6px 0 0;color:#164}
    label{display:block;margin:8px 0 6px;font-weight:600;color:var(--deep)}
    select,input[type="text"]{width:100%;padding:10px;border-radius:8px;border:1px solid #d7e3ea}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    button{background:var(--deep);color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    button.ghost{background:#eef7fa;color:var(--deep);border:1px solid #cfeef8}
    button.warn{background:#ff7b6b}
    button.small{padding:8px 10px;font-size:.95rem}
    .question-area{font-size:1.05rem;min-height:80px;display:flex;align-items:center}
    .question-text{font-weight:700;color:#06354f}
    textarea{width:100%;min-height:120px;padding:12px;border-radius:8px;border:1px solid #e1eef4}
    .status-row{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
    .badge{background:#e9fbff;color:#006d84;padding:6px 10px;border-radius:999px;font-weight:700}
    .transcript{background:#f7fbff;border-radius:8px;padding:12px;border-left:4px solid var(--accent);margin-top:12px}
    .feedback{background:#fff9f0;border-radius:8px;padding:12px;border-left:4px solid #ffbf6b;margin-top:12px}
    .results{margin-top:12px;padding:12px;background:#f1fcf6;border-left:4px solid #38b673;border-radius:8px}
    footer{margin-top:22px;text-align:center;padding:18px;color:#666}
    @media(max-width:980px){.grid{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <header>
    <h1>Live Interview Practice</h1>
        <p>Speak your answers ‚Äî get instant feedback from the AI interviewer</p>
  </header>


  <main>
    <div class="grid">
      <!-- Left: Interview flow -->
      <div class="card">
        <label for="role">Select job role</label>
        <select id="role">
          <option value="">‚Äî Choose role ‚Äî</option>
          <option value="developer">Software Developer</option>
          <option value="sales">Sales Representative</option>
          <option value="designer">Graphic Designer</option>
          <option value="accountant">Accountant</option>
        </select>

        <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
          <button id="startBtn">Start Interview</button>
          <button id="stopBtn" class="ghost" disabled>Stop Listening</button>
          <button id="repeatBtn" class="ghost" disabled>üîÅ Repeat Question</button>
          <button id="nextBtn" class="ghost" disabled>Next Question</button>
        </div>

        <div class="status-row" style="margin-top:14px">
          <div><strong>Progress</strong></div>
          <div><span class="badge" id="qCount">0 / 5</span></div>
        </div>

        <div style="margin-top:12px" class="question-area">
          <div class="question-text" id="currentQuestion">‚Äî Press Start to be asked a question ‚Äî</div>
        </div>

        <div style="margin-top:12px">
          <label>Your Spoken Answer (preview)</label>
          <div id="transcriptBox" class="transcript">No transcript yet.</div>

          <label style="margin-top:12px">Optional: Add notes or refine your answer</label>
          <textarea id="notes" placeholder="Type improvements, examples, or the STAR structure you used..."></textarea>

          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <button id="submitAnswerBtn" class="ghost" disabled>Submit Answer</button>
            <button id="speakFeedbackBtn" class="ghost" disabled>üîä Speak Feedback</button>
            <button id="endSessionBtn" class="warn" disabled>End Session</button>
          </div>

          <div id="answerFeedback" class="feedback" style="display:none"></div>
        </div>
      </div>

      <!-- Right: Helper + summary -->
      <aside class="card">
        <div>
          <strong>How this works</strong>
          <p style="margin:8px 0 0;color:#264b59">The AI interviewer asks role-specific questions using your browser's speech synthesis. When you speak, speech recognition captures your answer and displays a transcript. The page runs a quick evaluation and gives written + spoken feedback.</p>
        </div>

        <hr style="margin:14px 0"/>

        <div>
          <strong>Quick tips</strong>
          <ul style="margin:8px 0 0 18px">
            <li>Use the STAR framework (Situation, Task, Action, Result).</li>
            <li>Try to speak for 30‚Äì90 seconds with concrete examples.</li>
            <li>Be clear and pace yourself; take a breath before answering.</li>
          </ul>
        </div>

        <hr style="margin:14px 0"/>

        <div>
          <strong>Session summary</strong>
          <div id="sessionSummary" class="results">
            <div><strong>Answered:</strong> <span id="answeredCount">0</span></div>
            <div style="margin-top:6px"><strong>Average score:</strong> <span id="avgScore">‚Äî</span></div>
            <div style="margin-top:8px"><strong>Highlights:</strong>
              <ul id="highlights" style="margin:8px 0 0 18px;padding:0"></ul>
            </div>
          </div>
        </div>

        <hr style="margin:14px 0"/>

        <div>
          <strong>Compatibility</strong>
          <p style="margin:8px 0 0">Speech recognition works best in Chrome/Edge. If your browser doesn't support it, you'll still see guidance and can type answers.</p>
        </div>
      </aside>
    </div>

    <!-- RETURN BUTTON -->

    <a href="interview-practice.html" class="btn next-btn">Next: Practice Interview ‚Üí</a>
        <a href="interview-coaching.html" class="btn back-btn">‚Üê Back to Coaching</a>
    
    <footer>
    ¬© 2025 Job Seekers | Interview Coaching Program
  </footer>

  <script>
  // ---- Feature detection ----
  const synth = window.speechSynthesis;
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition || null;
  const supportsRecognition = !!SpeechRecognition;
  const userDisplay = document.getElementById('userDisplay');

  // show stored name if exists
  const storedName = localStorage.getItem('userName');
  if (storedName) userDisplay.textContent = storedName;

  // Questions by role
  const Q = {
    developer: [
      "Describe a challenging bug you fixed and how you found the solution.",
      "How do you ensure code quality when working with a team?",
      "Tell me about a project where you improved performance or scalability."
    ],
    sales: [
      "Tell me about your most difficult sale and how you closed it.",
      "How do you handle a customer who resists your product?",
      "Describe a time you exceeded your sales quota."
    ],
    designer: [
      "Walk me through your design process for a recent project.",
      "How do you incorporate user feedback into your designs?",
      "Tell me about a time you solved a usability problem."
    ],
    accountant: [
      "Describe how you ensure accuracy in financial reporting.",
      "Tell me about a time you found and corrected an accounting error.",
      "How do you prioritize tasks during a busy reporting period?"
    ]
  };

  // keywords for simple evaluation
  const keywords = {
    developer: ["bug","fix","debug","test","code","refactor","performance","scalab","optimiz"],
    sales: ["sale","close","client","negoti","quota","pipeline","pitch","objection"],
    designer: ["design","user","prototype","ux","ui","feedback","usabilit","wireframe"],
    accountant: ["reconcile","audit","financial","report","ledger","accuracy","complianc","variance"]
  };

  // STAR keyword set
  const starWords = ["situation","task","action","result","situation,","task,","action,","result,","situation:","task:","action:","result:"];

  // DOM refs
  const roleEl = document.getElementById('role');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const repeatBtn = document.getElementById('repeatBtn');
  const nextBtn = document.getElementById('nextBtn');
  const currentQuestionEl = document.getElementById('currentQuestion');
  const transcriptBox = document.getElementById('transcriptBox');
  const submitAnswerBtn = document.getElementById('submitAnswerBtn');
  const speakFeedbackBtn = document.getElementById('speakFeedbackBtn');
  const endSessionBtn = document.getElementById('endSessionBtn');
  const answerFeedbackEl = document.getElementById('answerFeedback');
  const qCountBadge = document.getElementById('qCount');
  const answeredCountEl = document.getElementById('answeredCount');
  const avgScoreEl = document.getElementById('avgScore');
  const highlightsEl = document.getElementById('highlights');

  // session state
  let recognition = null;
  let listening = false;
  let currentQuestion = "";
  let roleQuestions = [];
  let asked = 0;
  const targetQuestions = 5; // number to finish session
  let scores = [];
  let highlights = [];

  // helper: speak text via TTS
  function speak(text, opts = {}) {
    if (!synth) return;
    synth.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = opts.lang || 'en-US';
    u.rate = opts.rate || 1;
    u.pitch = opts.pitch || 1;
    u.volume = opts.volume || 1;
    // choose a voice similar to neutral; try to pick a female or default voice if available
    const voices = synth.getVoices();
    if (voices && voices.length) {
      // try to find "en-US" voice
      const found = voices.find(v => v.lang && v.lang.includes('en') && v.name.toLowerCase().includes('female'));
      if (found) u.voice = found;
    }
    synth.speak(u);
  }

  // start speech recognition
  function startRecognition() {
    if (!SpeechRecognition) {
      transcriptBox.textContent = "Speech recognition not available in this browser. Please answer by speaking into the OS-level mic (or type your answer below).";
      return;
    }
    if (recognition) {
      recognition.stop();
      recognition = null;
    }
    recognition = new SpeechRecognition();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onstart = () => {
      listening = true;
      stopBtn.disabled = false;
      stopBtn.textContent = "Stop Listening";
    };
    recognition.onerror = (e) => {
      listening = false;
      stopBtn.disabled = true;
      transcriptBox.textContent = "Recognition error: " + (e.error || "unknown");
    };
    recognition.onresult = (evt) => {
      const transcript = evt.results[0][0].transcript;
      transcriptBox.textContent = transcript;
      // enable submit
      submitAnswerBtn.disabled = false;
      speakFeedbackBtn.disabled = false;
    };
    recognition.onend = () => {
      listening = false;
      stopBtn.disabled = true;
      stopBtn.textContent = "Stop Listening";
    };
    recognition.start();
  }

  function stopRecognition() {
    if (recognition) recognition.stop();
    listening = false;
    stopBtn.disabled = true;
  }

  // evaluate answer heuristically
  function evaluateAnswer(transcript, question, role) {
    transcript = (transcript || "").toLowerCase();
    let score = 0;
    let reasons = [];

    // length check
    const words = transcript.split(/\s+/).filter(Boolean).length;
    if (words >= 30) { score += 2; reasons.push("Detailed answer (good length)"); }
    else if (words >= 12) { score += 1; reasons.push("Concise ‚Äî can add more details"); }
    else { reasons.push("Too short ‚Äî add examples and details"); }

    // keyword match (role)
    const kwlist = keywords[role] || [];
    const kwMatch = kwlist.some(k => transcript.includes(k));
    if (kwMatch) { score += 2; reasons.push("Used role-related keywords"); }
    else { reasons.push("Missing role-specific keywords"); }

    // STAR presence
    const starFound = starWords.some(s => transcript.includes(s));
    if (starFound) { score += 1; reasons.push("STAR structure detected"); }
    else reasons.push("STAR structure not clearly used");

    // fluency heuristic: more than 2 filler "um/uh" (simple check)
    const fillerMatches = (transcript.match(/\b(um|uh|like|you know)\b/g) || []).length;
    if (fillerMatches > 3) {
      reasons.push("Some fillers detected ‚Äî try pausing instead");
      score = Math.max(0, score - 1);
    }

    // normalize to 0-10 scale
    const normalized = Math.max(0, Math.min(10, Math.round((score / 5) * 10)));
    return { score: normalized, reasons };
  }

  // start interview flow
  function startInterview() {
    const role = roleEl.value;
    if (!role) { alert("Please select a job role first."); return; }

    // load question pool for role
    roleQuestions = Q[role].slice(); // copy
    asked = 0;
    scores = [];
    highlights = [];
    updateSessionUI();
    nextQuestion();

    // enable controls
    endSessionBtn.disabled = false;
    repeatBtn.disabled = false;
    nextBtn.disabled = true; // next becomes enabled after submit
    submitAnswerBtn.disabled = true;
    speakFeedbackBtn.disabled = true;
    startBtn.disabled = true;
  }

  // get a random question and ask it aloud
  function nextQuestion() {
    const role = roleEl.value;
    if (!role) { alert("Please select a job role."); return; }

    if (!roleQuestions.length) {
      // reload the array if exhausted
      roleQuestions = Q[role].slice();
    }

    // pick a random question and remove it from pool
    const idx = Math.floor(Math.random() * roleQuestions.length);
    currentQuestion = roleQuestions.splice(idx,1)[0];
    currentQuestionEl.textContent = currentQuestion;
    transcriptBox.textContent = "Listening will start after the question is spoken (grant mic permission when prompted).";
    // speak question
    speak(currentQuestion);
    // start recognition shortly after speaking finishes (give TTS time)
    setTimeout(() => {
      startRecognition();
    }, 900);

    // reset UI for new question
    submitAnswerBtn.disabled = true;
    speakFeedbackBtn.disabled = true;
    document.getElementById('notes').value = "";
    answerFeedbackEl.style.display = "none";
  }

  // repeat question (re-speak)
  function repeatQuestion() {
    if (!currentQuestion) return;
    speak(currentQuestion);
  }

  // submit answer: evaluate and show feedback
  function submitAnswer() {
    const transcript = transcriptBox.textContent === "No transcript yet." ? "" : transcriptBox.textContent;
    const role = roleEl.value || "developer";
    if (!transcript || transcript.length < 3) {
      // allow typed notes if speech recognition not supported
      const typed = document.getElementById('notes').value.trim();
      if (!typed) {
        alert("No spoken answer found. Either speak your answer or type it into the notes field.");
        return;
      }
    }

    const evaluation = evaluateAnswer(transcript || document.getElementById('notes').value, currentQuestion, role);
    // store results
    scores.push(evaluation.score);
    asked++;
    qCountBadge.textContent = `${asked} / ${targetQuestions}`;
    updateSessionUI();

    // store highlight if score good
    if (evaluation.score >= 6) {
      highlights.push({ q: currentQuestion, score: evaluation.score });
    }

    // show feedback text and speak feedback
    const fbText = buildFeedbackText(evaluation);
    answerFeedbackEl.innerHTML = fbText;
    answerFeedbackEl.style.display = 'block';
    speak("Feedback: " + stripHtmlForSpeech(fbText)); // spoken feedback

    // enable next and repeat
    nextBtn.disabled = false;
    repeatBtn.disabled = false;
    submitAnswerBtn.disabled = true;
    speakFeedbackBtn.disabled = false;
    endSessionBtn.disabled = false;

    // auto-end if reached target
    if (asked >= targetQuestions) {
      finalizeSession();
    }
  }

  function speakFeedback() {
    if (answerFeedbackEl.style.display === 'none') return;
    const txt = stripHtmlForSpeech(answerFeedbackEl.innerHTML);
    speak(txt);
  }

  function buildFeedbackText(evaluation) {
    const reasons = evaluation.reasons.map(r => `<li>${escapeHtml(r)}</li>`).join("");
    return `<strong>Score (0-10): ${evaluation.score}</strong>
            <div style="margin-top:8px;">Feedback:</div>
            <ul style="margin-top:6px;">${reasons}</ul>`;
  }

  function stripHtmlForSpeech(html) {
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    return tmp.textContent || tmp.innerText || "";
  }

  function escapeHtml(s) {
    return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
  }

  // update session UI summary
  function updateSessionUI() {
    answeredCountEl.textContent = asked;
    if (scores.length) {
      const avg = Math.round((scores.reduce((a,b)=>a+b,0)/scores.length)*10)/10;
      avgScoreEl.textContent = avg + " / 10";
    } else avgScoreEl.textContent = "‚Äî";
    highlightsEl.innerHTML = highlights.length ? highlights.map(h => `<li>${escapeHtml(h.q)} ‚Äî ${h.score}/10</li>`).join("") : "<li>None yet ‚Äî keep going</li>";
  }

  // finalize session when enough questions answered
  function finalizeSession() {
    // disable next/start controls
    startBtn.disabled = false;
    nextBtn.disabled = true;
    repeatBtn.disabled = true;
    submitAnswerBtn.disabled = true;
    speakFeedbackBtn.disabled = true;
    endSessionBtn.disabled = true;
    stopRecognition();

    // show final summary spoken
    const avg = scores.length ? Math.round((scores.reduce((a,b)=>a+b,0)/scores.length)*10)/10 : 0;
    const msg = `Session complete. You answered ${asked} questions. Your average score is ${avg} out of 10. Well done!`;
    speak(msg);

    // persist simple progress in localStorage so user can proceed elsewhere
    localStorage.setItem('liveInterviewCompleted', 'true');

    // present a visual dialog
    setTimeout(() => {
      alert(`Session complete!\nAnswered: ${asked}\nAverage score: ${avg}/10\nYou can repeat the session or go back to typing practice.`);
    }, 600);
  }

  // end session manually
  function endSession() {
    if (!confirm("End the interview session now?")) return;
    finalizeSession();
  }

  // handlers / wiring
  startBtn.addEventListener('click', startInterview);
  repeatBtn.addEventListener('click', repeatQuestion);
  nextBtn.addEventListener('click', () => {
    nextBtn.disabled = true;
    nextQuestion();
  });
  stopBtn.addEventListener('click', () => {
    stopRecognition();
    stopBtn.disabled = true;
  });
  submitAnswerBtn.addEventListener('click', submitAnswer);
  speakFeedbackBtn.addEventListener('click', speakFeedback);
  endSessionBtn.addEventListener('click', endSession);

  // when recognition produces transcript, enable submit
  // We already set recognition.onresult in startRecognition

  // track question count UI
  function updateQCountUI() {
    qCountBadge.textContent = `${asked} / ${targetQuestions}`;
  }
  updateQCountUI();

  // Accessibility / Feature-notes
  if (!supportsRecognition) {
    // show a gentle notice in transcript box
    transcriptBox.textContent = "Your browser does not support SpeechRecognition. You can still use this page: click Start, speak if system-level speech input is available, or type your answers in Notes and press Submit.";
  } else {
    transcriptBox.textContent = "Press Start to begin. When the question finishes, grant microphone permission if prompted.";
  }

  // try to warm up voices (some browsers need user gesture)
  window.speechSynthesis.onvoiceschanged = () => {
    // no-op: this warms voices list
  };

  // small helper to keep UI consistent
  (function initFromStorage(){
    // show user display name if present
    if (storedName) userDisplay.textContent = storedName;
  })();

  </script>
</body>
</html>
